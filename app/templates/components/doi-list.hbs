<div class='col-md-9 panel-list' id="content">
  {{model-search model=model sortable=true}}

  {{#if model}}
    {{#each model as |doi|}}
      <div class="panel panel-transparent">
        <div class="panel-body">
          <h3 class="work">
            {{#link-to "clients.show.dois.show" doi.client.id doi.id}}{{if doi.title doi.title doi.doi}}{{/link-to}}
            <span class="small">{{doi.resource-type.title}}</span>
          </h3>
          {{#if doi.creator}}
            {{{format-author doi.creator}}}
          {{/if}}
          {{#if doi.published}}
            <div class="metadata">
              {{format-metadata doi.published resourceType=doi.resource-type resourceTypeSubtype=doi.resourceTypeSubtype publisher=doi.publisher version=doi.version}}
            </div>
          {{/if}}
          {{#if doi.description}}
            <div class="description">
              {{format-text doi.description limit=75}}
            </div>
          {{/if}}
          <div class="updated">
            Last updated {{format-time doi.updated year='numeric' month='long' day='numeric'}}.
            <span class="text-{{doi.state}}">{{titleize doi.state}}</span>
          </div>
          {{#if doi.license}}
            {{cc-license licenseURL=doi.license}}
          {{/if}}
        </div>
        <div class="panel-footer">
          {{#if doi.isDraft}}
            {{fa-icon "info-circle"}} {{doi.doi}}
          {{else}}
            <a href="{{doi.identifier}}">{{fa-icon "external-link"}} {{doi.identifier}}</a>
          {{/if}}
        </div>
      </div>
    {{/each}}
    <div class="text-center">
      {{#if (gt model.meta.total_pages 1)}}
        {{page-numbers content=model numPagesToShow=5 showFL=true}}
      {{/if}}
    </div>
  {{else}}
    {{#bs-alert dismissible=false type="warning"}}
      No DOIs found.
    {{/bs-alert}}
  {{/if}}
</div>

<div class='col-md-3'>
  {{#if (and (can "create doi" model) (eq link "clients.show.dois"))}}
    <div class="panel facets">
      <div class="panel-body">
        <div class="btn-toolbar">
          <div class="btn-group-vertical btn-group-sm">
            {{#link-to "clients.show.dois.new" client.id class="btn btn-warning"}}{{fa-icon "wpforms"}} Add{{if media.isXl ' DOI'}} (Form){{/link-to}}
            {{#link-to "clients.show.dois.upload" client.id class="btn btn-warning"}}{{fa-icon "upload"}} Add{{if media.isXl ' DOI'}} (File Upload){{/link-to}}
          </div>
        </div>
      </div>
    </div>
  {{else if (and (can "transfer doi" model) (gt model.length 0))}}
    <div class="panel facets">
      <div class="panel-body">
        <div class="btn-toolbar">
          <div class="btn-group btn-group-sm">
            {{#link-to "clients.show.transfer" model.otherParams.client-id class="btn btn-warning" id="transfer-dois"}}{{fa-icon "arrow-circle-o-right"}}Transfer{{if media.isXl ' DOIs'}}{{/link-to}}
          </div>
        </div>
      </div>
    </div>
  {{else}}
    <div class="panel panel-transparent">
      <div class="panel-body">
        <div class="edit"></div>
      </div>
    </div>
  {{/if}}

  {{#if model.meta.states}}
    <div class="panel facets add">
      <div class="panel-body">
        <h4>State</h4>
        <ul>
          {{#each model.meta.states as |state|}}
            <li>
              {{#if model.otherParams.state}}
                {{#link-to link (query-params state=null)}}{{fa-icon "check-square-o"}}{{/link-to}}
              {{else}}
                {{#link-to link (query-params state=state.id)}}{{fa-icon "square-o"}}{{/link-to}}
              {{/if}}
              <div class="facet-title">{{state.title}}</div>
              <span class="number pull-right">{{format-number state.count}}</span>
              <div class="clearfix"/>
            </li>
          {{/each}}
        </ul>
      </div>
    </div>
  {{/if}}
  {{#if model.meta.resource-types}}
    <div class="panel facets">
      <div class="panel-body">
        <h4>Resource Types</h4>
        <ul>
          {{#each model.meta.resource-types as |resource-type|}}
            <li>
              {{#if model.otherParams.resource-type-id}}
                {{#link-to link (query-params resource-type-id='')}}{{fa-icon "check-square-o"}}{{/link-to}}
              {{else}}
                {{#link-to link (query-params resource-type-id=resource-type.id)}}{{fa-icon "square-o"}}{{/link-to}}
              {{/if}}
              <div class="facet-title">{{resource-type.title}}</div>
              <span class="number pull-right">{{format-number resource-type.count}}</span>
              <div class="clearfix"/>
            </li>
          {{/each}}
        </ul>
      </div>
    </div>
  {{/if}}
  {{#if model.meta.years}}
    <div class="panel facets">
      <div class="panel-body">
        <h4>Publication Year</h4>
        <ul>
          {{#each model.meta.years as |year|}}
            <li>
              {{#if model.otherParams.year}}
                {{#link-to link (query-params year='')}}{{fa-icon "check-square-o"}}{{/link-to}}
              {{else}}
                {{#link-to link (query-params year=year.id)}}{{fa-icon "square-o"}}{{/link-to}}
              {{/if}}
              <div class="facet-title">{{year.title}}</div>
              <span class="number pull-right">{{format-number year.count}}</span>
              <div class="clearfix"/>
            </li>
          {{/each}}
        </ul>
      </div>
    </div>
  {{/if}}
  {{#if model.meta.registered}}
    <div class="panel facets">
      <div class="panel-body">
        <h4>DOI Registration Year</h4>
        <ul>
          {{#each model.meta.registered as |year|}}
            <li>
              {{#if model.otherParams.registered}}
                {{#link-to link (query-params registered='')}}{{fa-icon "check-square-o"}}{{/link-to}}
              {{else}}
                {{#link-to link (query-params registered=year.id)}}{{fa-icon "square-o"}}{{/link-to}}
              {{/if}}
              <div class="facet-title">{{year.title}}</div>
              <span class="number pull-right">{{format-number year.count}}</span>
              <div class="clearfix"/>
            </li>
          {{/each}}
        </ul>
      </div>
    </div>
  {{/if}}
  {{#if model.meta.schema-versions}}
    <div class="panel facets">
      <div class="panel-body">
        <h4>Schema Versions</h4>
        <ul>
          {{#each model.meta.schema-versions as |schema-version|}}
            <li>
              {{#if model.otherParams.schema-version}}
                {{#link-to link (query-params schema-version='')}}{{fa-icon "check-square-o"}}{{/link-to}}
              {{else}}
                {{#link-to link (query-params schema-version=schema-version.id)}}{{fa-icon "square-o"}}{{/link-to}}
              {{/if}}
              <div class="facet-title">{{schema-version.title}}</div>
              <span class="number pull-right">{{format-number schema-version.count}}</span>
              <div class="clearfix"/>
            </li>
          {{/each}}
        </ul>
      </div>
    </div>
  {{/if}}
</div>
